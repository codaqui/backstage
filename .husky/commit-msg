#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ğŸ“ Commit Message Validation
# Ensures commit messages follow conventional commits format

commit_msg_file=$1
commit_msg=$(head -n1 "$commit_msg_file")

# Conventional Commits pattern:
# type(scope): subject
# 
# Types: feat, fix, docs, style, refactor, test, chore, perf, ci, build, revert
# Example: feat(catalog): add new kubernetes resources page

pattern="^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\([a-z0-9-]+\))?: .+$"

if ! echo "$commit_msg" | grep -qE "$pattern"; then
  echo "âŒ Invalid commit message format!"
  echo ""
  echo "ğŸ“‹ Commit message must follow Conventional Commits:"
  echo "   type(scope): subject"
  echo ""
  echo "ğŸ“Œ Valid types:"
  echo "   feat     - New feature"
  echo "   fix      - Bug fix"
  echo "   docs     - Documentation changes"
  echo "   style    - Code style (formatting, no logic change)"
  echo "   refactor - Code refactoring"
  echo "   test     - Adding or updating tests"
  echo "   chore    - Maintenance tasks"
  echo "   perf     - Performance improvements"
  echo "   ci       - CI/CD changes"
  echo "   build    - Build system changes"
  echo "   revert   - Revert previous commit"
  echo ""
  echo "âœ… Good examples:"
  echo "   feat(catalog): add kubernetes resources page"
  echo "   fix(auth): resolve oauth callback issue"
  echo "   docs(readme): update installation instructions"
  echo ""
  echo "âŒ Your commit message:"
  echo "   $commit_msg"
  echo ""
  exit 1
fi

echo "âœ… Commit message format valid"
